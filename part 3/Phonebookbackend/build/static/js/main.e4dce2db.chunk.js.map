{"version":3,"sources":["services/persons.js","components/Persons.js","components/PersonsForm.js","components/Filter.js","components/SuccessNotification.js","components/ErrorNotification.js","index.js"],"names":["baseUrl","axios","get","newObject","post","id","put","deleteId","delete","Persons","persons","handleDelete","console","log","name","number","onClick","PersonsForm","addName","newName","handleNameChange","newNumber","handleNumberChange","onSubmit","value","onChange","type","Filter","filterResult","SuccessNotification","message","className","ErrorNotification","then","response","data","App","useState","setPersons","setNewName","setNewNumber","newFilterword","setNewFilterword","successMessage","setSuccessMessage","errorMessage","setErrorMessage","useEffect","personService","length","filter","item","values","Object","str","map","String","toLowerCase","find","includes","toString","window","confirm","n","catch","err","setTimeout","event","target","i","personsCopy","preventDefault","nameObject","replace","alert","JSON","stringify","indexOf","concat","duplicateCheck","person","returnedPerson","error","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.e4dce2db.chunk.js","sourcesContent":["import axios from \"axios\";\r\nconst baseUrl = \"http://localhost:3001/persons\";\r\n\r\nconst getAll = () => {\r\n  return axios.get(baseUrl);\r\n};\r\n\r\nconst create = (newObject) => {\r\n  return axios.post(baseUrl, newObject);\r\n};\r\n\r\nconst update = (id, newObject) => {\r\n  return axios.put(`${baseUrl}/${id}`, newObject);\r\n};\r\n\r\nconst deleteperson = (deleteId) => {\r\n  return axios.delete(`${baseUrl}/${deleteId}`);\r\n};\r\n\r\nexport default { getAll, create, update, deleteperson };\r\n","import React from \"react\";\r\n\r\n//显示人名组件\r\nconst Persons = ({ persons, handleDelete }) => {\r\n  console.log({ persons });\r\n  return (\r\n    <>\r\n      <li>\r\n        {persons.name} {persons.number}\r\n        <button onClick={handleDelete}> delete</button>\r\n      </li>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Persons;\r\n","import React from 'react'\r\n\r\nconst PersonsForm =({addName,newName,handleNameChange,newNumber,handleNumberChange})=>{\r\n    return(\r\n        <form onSubmit={addName}>\r\n        <div>\r\n          name: <input value={newName} onChange={handleNameChange}/>\r\n        </div>\r\n        <div>\r\n          number: <input value={newNumber} onChange={handleNumberChange}/>\r\n        </div>\r\n\r\n        <div>\r\n          <button type=\"submit\" >add</button>\r\n        </div>\r\n      </form>\r\n\r\n    )\r\n}\r\n\r\n\r\nexport default PersonsForm\r\n","import React from \"react\";\r\n\r\n// const Filter =({newFilterword,setNewFilterword,persons})=>{\r\n\r\n//  //const personsCopy ={...persons}\r\n\r\n//  const filterByValue = function filterByValue(arr, word) {\r\n//   return arr.filter(o =>\r\n//       Object.keys(o).some(k => o[k].toLowerCase().includes(word.toLowerCase())));\r\n// }\r\n\r\n// const result = filterByValue(persons,newFilterword);\r\n// console.log('result',result)\r\n\r\n//   const handleFilterwordChange =(event)=>{\r\n//     setNewFilterword(event.target.value)\r\n//   }\r\n\r\n//   return(\r\n//     <div>\r\n//       filter shown with a <input value={newFilterword} onChange={handleFilterwordChange}/>\r\n//     </div>\r\n//   )\r\n// }\r\n\r\n//不在组件中写任何函数和算法，并在APP根组件下进行遍历显示\r\nconst Filter = ({ filterResult }) => {\r\n  return (\r\n    <li>\r\n      {filterResult.name} {filterResult.number}\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default Filter;\r\n","import React from \"react\";\r\n\r\nconst SuccessNotification = ({ message }) => {\r\n  if (message === null) {\r\n    return null;\r\n  }\r\n\r\n  return <div className=\"success\">{message}</div>;\r\n};\r\n\r\nexport default SuccessNotification;\r\n","import React from \"react\";\r\n\r\nconst ErrorNotification = ({ message }) => {\r\n  if (message === null) {\r\n    return null;\r\n  }\r\n\r\n  return <div className=\"error\">{message}</div>;\r\n};\r\n\r\nexport default ErrorNotification;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\n\r\nimport axios from \"axios\";\r\nimport personService from \"./services/persons\";\r\n\r\nimport Persons from \"./components/Persons\";\r\nimport PersonsForm from \"./components/PersonsForm\";\r\nimport Filter from \"./components/Filter\";\r\nimport SuccessNotification from \"./components/SuccessNotification\";\r\nimport ErrorNotification from \"./components/ErrorNotification\";\r\n\r\naxios.get(\"http://localhost:3001/persons\").then((response) => {\r\n  const persons = response.data;\r\n  console.log(\"axios\", persons);\r\n});\r\n\r\nconst App = () => {\r\n  //这个状态用props传进来的初始人名数组作为状态初始化，保存到notes中。\r\n  const [persons, setPersons] = useState([]);\r\n  const [newName, setNewName] = useState(\"\");\r\n  const [newNumber, setNewNumber] = useState(\"\");\r\n  const [newFilterword, setNewFilterword] = useState(\"\");\r\n  const [successMessage, setSuccessMessage] = useState(null);\r\n  const [errorMessage, setErrorMessage] = useState(null);\r\n\r\n  useEffect(() => {\r\n    console.log(\"effect\");\r\n    // axios.get(\"http://localhost:3001/persons\")\r\n    personService.getAll().then((response) => {\r\n      console.log(\"getAll()response\", response);\r\n      console.log(\"promise fulfilled\");\r\n      setPersons(response.data);\r\n      console.log(\"getAll()response.data\", response.data);\r\n    });\r\n  }, []);\r\n  console.log(\"render\", persons.length, \"notes\");\r\n\r\n  const addName = (event) => {\r\n    const personsCopy = { ...persons };\r\n\r\n    console.log(\"personsCopy\", personsCopy);\r\n    console.log(\"newName\", newName);\r\n    console.log(\"personsCopy0.name\", personsCopy[0].name);\r\n    console.log(\"personspersons\", persons);\r\n    // alert('提交的名字: ' + newName);\r\n    event.preventDefault();\r\n    console.log(\"button clicked\", event.target);\r\n\r\n    //设定一个对象格式，确定数据的保存格式为一个对象\r\n    const nameObject = {\r\n      name: newName,\r\n      number: newNumber,\r\n    };\r\n\r\n    console.log(\"addnameObject\", nameObject);\r\n    console.log(\"nameObject.name\", nameObject.name);\r\n\r\n    //如果为空值则提醒\r\n    if (\r\n      String(nameObject.name).replace(/(^\\s*)|(\\s*$)/g, \"\").length === 0 ||\r\n      String(nameObject.number).replace(/(^\\s*)|(\\s*$)/g, \"\").length === 0\r\n    ) {\r\n      console.log(\"nameObject.name\", nameObject.name);\r\n      alert(\"empty string,plz reconfirm\");\r\n      //未存在则添加\r\n    } else if (\r\n      JSON.stringify(personsCopy).indexOf(JSON.stringify(newName)) === -1\r\n    ) {\r\n      //添加新便笺到便笺列表中，concat方式数组添加\r\n      // setPersons(persons.concat(nameObject));\r\n      //重置受控input元素的值\r\n      // setNewName(\"\");\r\n      // setNewNumber(\"\");\r\n\r\n      personService\r\n        .create(nameObject)\r\n        // .post(\"http://localhost:3001/persons\", nameObject)\r\n        .then((response) => {\r\n          setSuccessMessage(`Note '${newName}' was add successfully`);\r\n          setTimeout(() => {\r\n            setSuccessMessage(null);\r\n          }, 5000);\r\n          setPersons(persons.concat(response.data));\r\n          setNewName(\"\");\r\n          setNewNumber(\"\");\r\n        });\r\n    } else {\r\n      //存在则提醒,并询问是否替换内容\r\n      const duplicateCheck = persons.find((person) => person.name === newName);\r\n      //名字相同，电话不同,则询问是否替换\r\n      if (\r\n        typeof duplicateCheck !== \"undefined\" &&\r\n        duplicateCheck.number !== newNumber\r\n      ) {\r\n        personService\r\n          .update(duplicateCheck.id, {\r\n            name: duplicateCheck.name,\r\n            number: newNumber,\r\n          })\r\n          .then((returnedPerson) => {\r\n            if (\r\n              window.confirm(\r\n                `${returnedPerson.name} is already added to phonebook,replace the old number with a new one?`\r\n              )\r\n            ) {\r\n              setPersons(\r\n                persons.map((person) =>\r\n                  person.id !== duplicateCheck.id ? person : returnedPerson\r\n                )\r\n              );\r\n            }\r\n            setNewName(\"\");\r\n            setNewNumber(\"\");\r\n          })\r\n          .catch((error) => {\r\n            console.log(\"fail\");\r\n            setErrorMessage(\r\n              `Information of '${newName}' has already been removed from the server`\r\n            );\r\n            setTimeout(() => {\r\n              setErrorMessage(null);\r\n            }, 5000);\r\n          });\r\n        //为什么要加return?\r\n        // return;\r\n      } else if (typeof duplicateCheck !== \"undefined\") {\r\n        //名字电话相同则提醒已存在\r\n        alert(`${newName} is already added to phonebook`);\r\n        setNewName(\"\");\r\n        setNewNumber(\"\");\r\n        // return;\r\n      }\r\n    }\r\n\r\n    //question : 不去除前后无效空字符串，否则也会被添加\r\n    //question:需刷新后替换的新数据才会显示，如何优化？\r\n  };\r\n\r\n  function filterByValue(values, str) {\r\n    return values\r\n      .map(function (value) {\r\n        return String(value).toLowerCase();\r\n      })\r\n      .find(function (value) {\r\n        return value.includes(str.toString().toLowerCase());\r\n      });\r\n  }\r\n\r\n  const filterResult = persons.filter(function (item) {\r\n    return filterByValue(Object.values(item), newFilterword);\r\n  });\r\n\r\n  console.log(\"result2222\", filterResult);\r\n  console.log(\"persons2222\", persons);\r\n  console.log(\"newFilterword2222\", newFilterword);\r\n\r\n  const handleDelete = (id) => {\r\n    console.log(\"handleDelete\", persons);\r\n    if (\r\n      window.confirm(`Do you really want to delete ${persons[id - 1].name}?`)\r\n    ) {\r\n      personService\r\n        .deleteperson(id)\r\n        .then((response) => {\r\n          //为什么这里console出来空数组？\r\n          console.log(\"deletedeletedelete\", response.data);\r\n          setPersons(persons.filter((n) => n.id !== id));\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          setErrorMessage(\r\n            `Information of '${\r\n              persons[id - 1].name\r\n            }' has already been removed from the server`\r\n          );\r\n          setTimeout(() => {\r\n            setErrorMessage(null);\r\n          }, 5000);\r\n        });\r\n    }\r\n  };\r\n\r\n  const handleNameChange = (event) => {\r\n    console.log(event.target.value);\r\n    setNewName(event.target.value);\r\n  };\r\n\r\n  const handleNumberChange = (event) => {\r\n    console.log(event.target.value);\r\n    setNewNumber(event.target.value);\r\n  };\r\n\r\n  const handleFilterwordChange = (event) => {\r\n    setNewFilterword(event.target.value);\r\n  };\r\n\r\n  //根据输入的自字符进行筛选\r\n  // const filterByValue = function filterByValue(arr, word) {\r\n  //   return arr.filter((o) =>\r\n  //     Object.keys(o).some((k) =>\r\n  //       o[k].toLowerCase().includes(word.toLowerCase())\r\n  //     )\r\n  //   );\r\n  // };\r\n  //TypeError: o[k].toLowerCase is not a function\r\n\r\n  //input数据转化为字符串便于筛选function 运行\r\n  // const inputValue = newFilterword.toString();\r\n  // console.log(\"typeof inputValue\", typeof inputValue);\r\n\r\n  //得到筛选结果\r\n  // const result = filterByValue(persons, inputValue);\r\n  return (\r\n    <div>\r\n      <ErrorNotification message={errorMessage} />\r\n      <SuccessNotification message={successMessage} />\r\n      <h2>Phonebook</h2>\r\n      filter shown with{\" \"}\r\n      <input value={newFilterword} onChange={handleFilterwordChange} />\r\n      <p>\r\n        {filterResult.map((filterResult, i) => (\r\n          <Filter key={i} filterResult={filterResult} />\r\n        ))}\r\n      </p>\r\n      <h1>add a new</h1>\r\n      <PersonsForm\r\n        addName={addName}\r\n        newName={newName}\r\n        handleNameChange={handleNameChange}\r\n        newNumber={newNumber}\r\n        handleNumberChange={handleNumberChange}\r\n      />\r\n      <h2>Numbers</h2>\r\n      <p>\r\n        {/* 数的顺序会影响显示，person,name不等于name,person */}\r\n        {persons.map((persons, i) => (\r\n          <Persons\r\n            key={i}\r\n            persons={persons}\r\n            handleDelete={() => handleDelete(persons.id)}\r\n          />\r\n        ))}\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\nexport default App;\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}